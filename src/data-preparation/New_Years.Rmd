---
title: "NewYears"
output:
  pdf_document: default
  html_document: default
date: "2023-03-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
# Install package
install.packages("dplyr")
install.packages("tidyverse")
install.packages("scales")
```


```{r}
# Load packages
library(dplyr)
library(tidyverse)
library(scales)
```


```{r}
# loading the data (listings)
list_ams <- read_csv('listings-ams.csv.gz')
list_lon <- read_csv("listings-london.csv.gz") 
list_par <- read_csv("listings-paris.csv.gz") 
list_rom <- read_csv("listings-rome.csv.gz") 

#loading the data (calendar)
cal_ams <- read_csv('calendar-ams.csv.gz')
cal_lon <- read_csv('calendar-london.csv.gz')
cal_par <- read_csv('calendar-paris.csv.gz')
cal_rom <- read_csv('calendar-rome.csv.gz')
```

**Summary statistics on the price of the cities**
```{r}
file_names <- c( 'listings-ams.csv.gz', "listings-london.csv.gz", "listings-paris.csv.gz", "listings-rome.csv.gz")
city_names <- c('Amsterdam', 'London', 'Paris', 'Rome')

# Loop through the file names and perform the same operations on each file
for (i in 1:length(file_names)) {
  list_data <- read_csv(file_names[i])
  list_prices <- list_data$price[!is.na(list_data$price)]
  list_prices <- as.numeric(gsub("\\$", "", list_prices))
  list_prices_summary <- summary(list_prices)
  print(paste("This is the price summary statistics for", city_names[i], ":" , list_prices_summary))
}
```

```{r}
#removing the dollar sign from the "price" column in the calendar data
cal_ams <- cal_ams %>%
  mutate(price = ifelse(!is.na(price), as.numeric(gsub("\\$", "", price)), price))
cal_lon <- cal_lon %>%
  mutate(price = ifelse(!is.na(price), as.numeric(gsub("\\$", "", price)), price))
cal_par <- cal_par %>%
  mutate(price = ifelse(!is.na(price), as.numeric(gsub("\\$", "", price)), price))
cal_rom <- cal_rom %>%
  mutate(price = ifelse(!is.na(price), as.numeric(gsub("\\$", "", price)), price))
```


**Summary statistics for beds per city**
```{r, echo=FALSE}
# Create a list of the cities
cities_list <- list(list_ams, list_lon, list_par, list_rom)

# Loop
for (i in 1:length(cities_list)) {
  cat("Summary statistics for", city_names[i], "\n")
  cat("Beds\n")
  print(summary(cities_list[[i]]$beds))
}
```

**List for calendar**
```{r, echo=FALSE}
# Create a list of the cities
cities_cal <- list(cal_ams, cal_lon, cal_par, cal_rom)

# Names of the cities
cities_names <- c("Amsterdam", "London", "Paris", "Rome")

```


```{r, echo=FALSE}
#subset lists of the city from the listing data
subset_list_ams <- data.frame(
  id = list_ams$id,
  host_id = list_ams$host_id,
  host_location = list_ams$host_location,
  neighbourhood = list_ams$neighbourhood,
  room_type = list_ams$room_type,
  price = list_ams$price,
  minimum_nights = list_ams$minimum_nights,
  city = "Amsterdam"
)

subset_list_lon <- data.frame(
  id = list_lon$id,
  host_id = list_lon$host_id,
  host_location= list_lon$host_location,
  neighbourhood = list_lon$neighbourhood,
  room_type = list_lon$room_type,
  price = list_lon$price,
  minimum_nights = list_lon$minimum_nights,
  city = "London"
)

subset_list_par <- data.frame(
  id = list_par$id,
  host_id = list_par$host_id,
  host_location = list_par$host_location,
  neighbourhood = list_par$neighbourhood,
  room_type = list_par$room_type,
  price = list_par$price,
  minimum_nights = list_par$minimum_nights,
  
  city = "Paris")

subset_list_rom <- data.frame(
  id = list_rom$id,
  host_id = list_rom$host_id,
  host_location = list_rom$host_location,
  neighbourhood = list_rom$neighbourhood,
  room_type = list_rom$room_type,
  price = list_rom$price,
  minimum_nights = list_rom$minimum_nights,
  city = "Rome")

total_list <- rbind(subset_list_ams, subset_list_lon, subset_list_par, subset_list_rom)


```


```{r, echo=FALSE}
##subset lists of the city from the calendar data
subset_cal_ams <- data.frame(
  listing_id = cal_ams$listing_id,
  date = cal_ams$date,
  available = cal_ams$available,
  adjusted_price = cal_ams$adjusted_price,
  price = cal_ams$price,
  minimum_nights = cal_ams$minimum_nights,
  maximum_nights = cal_ams$maximum_nights,
  city = "Amsterdam"
)

subset_cal_lon <- data.frame(
  listing_id = cal_lon$listing_id,
  date = cal_lon$date,
  available = cal_lon$available,
  adjusted_price = cal_lon$adjusted_price,
  price = cal_lon$price,
  minimum_nights = cal_lon$minimum_nights,
  maximum_nights = cal_lon$maximum_nights,
  city = "London"
)

subset_cal_par <- data.frame(
  listing_id = cal_par$listing_id,
  date = cal_par$date,
  available = cal_par$available,
  adjusted_price = cal_par$adjusted_price,
  price = cal_par$price,
  minimum_nights = cal_par$minimum_nights,
  maximum_nights = cal_par$maximum_nights,
  city = "Paris"
)

subset_cal_rom <- data.frame(
  listing_id = cal_rom$listing_id,
  date = cal_rom$date,
  available = cal_rom$available,
  adjusted_price = cal_rom$adjusted_price,
  price = cal_rom$price,
  minimum_nights = cal_rom$minimum_nights,
  maximum_nights = cal_rom$maximum_nights,
  city = "Rome"
)


total_cal <- rbind(subset_cal_ams, subset_cal_lon, subset_cal_par, subset_cal_rom)

```

**Number of available rooms per city** 
```{r, echo=FALSE}
#misschien moeten we een datum erbij voegen?
total_cal <- total_cal %>% 
  mutate(available = ifelse(available == TRUE, "available", available)) %>%
  mutate(available = ifelse(available == FALSE, "unavailable", available))

table(total_cal$available,  total_cal$city)
```

**Number of rooms types per city**
```{r, echo=FALSE}
table(total_list$room_type, total_list$city)
```

**Percentage number of rooms in Amsterdam**
```{r, echo=FALSE}
Amsterdam <- table(list_ams$room_type)
prop.table(Amsterdam)
```

**Percentage number of rooms in London**
```{r, echo=FALSE}
London <- table(list_lon$room_type)
prop.table(London)
```

**Percent number of rooms in Paris**
```{r, echo=FALSE}
Paris <- table(list_par$room_type)
prop.table(Paris)
```

**Percent number of rooms in Rome**
```{r, echo=FALSE}
Rome <- table(list_rom$room_type)
prop.table(Rome)
```

**Airbnb room types offered in Amsterdam**
```{r, echo=FALSE}
piepercent_ams<- round(100*table(list_ams$room_type)/sum(table(list_ams$room_type)), 1)
pie(table(list_ams$room_type), labels = paste0(piepercent_ams, "%"), main = "Room types in Amsterdam", col = rainbow(length(table(list_ams$room_type)), s = 0.5))
legend("bottomleft", c("Entire home/apt","Hotel room","Private room","Shared room"), cex = 0.8,
       fill = rainbow(length(table(list_ams$room_type)), s = 0.5))
```

**Airbnb room types offered in London**
```{r, echo=FALSE}
piepercent_lon<- round(100*table(list_lon$room_type)/sum(table(list_lon$room_type)), 1)
pie(table(list_lon$room_type), labels = paste0(piepercent_lon, "%"), main = "Room types in London", col = rainbow(length(table(list_lon$room_type)), s = 0.5))
legend("bottomright", c("Entire home/apt","Hotel room","Private room","Shared room"), cex = 0.8,
       fill = rainbow(length(table(list_lon$room_type)), s = 0.5))
```

**Airbnb room types offered in Paris**
```{r, echo=FALSE}
piepercent_par<- round(100*table(list_par$room_type)/sum(table(list_par$room_type)), 1)
pie(table(list_par$room_type), labels = paste0(piepercent_par, "%"), main = "Room types in Paris", col = rainbow(length(table(list_par$room_type)), s = 0.5))
legend("bottomleft", c("Entire home/apt","Hotel room","Private room","Shared room"), cex = 0.8,
       fill = rainbow(length(table(list_par$room_type)), s = 0.5))
```


**Airbnb room types offered in Rome**
```{r, echo=FALSE}
piepercent_rom<- round(100*table(list_rom$room_type)/sum(table(list_rom$room_type)), 1)
pie(table(list_rom$room_type), labels = paste0(piepercent_rom, "%"), main = "Room types in Rome", col = rainbow(length(table(list_rom$room_type)), s = 0.5))
legend("topright", c("Entire home/apt","Hotel room","Private room","Shared room"), cex = 0.8,
       fill = rainbow(length(table(list_rom$room_type)), s = 0.5))
```

**Quantity of type of rooms in Amsterdam**
```{r, echo=FALSE}
ggplot(list_ams, aes(x = room_type)) +
  geom_bar(aes(fill = room_type), position = "dodge") +
  ggtitle("Amsterdam") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Type of room", y = "Number of rooms", fill = "Type of room") +
  scale_fill_viridis_d()
```

**Quantity of type of rooms in London**
```{r, echo=FALSE}
ggplot(list_lon, aes(x = room_type)) +
  geom_bar(aes(fill = room_type), position = "dodge") +
  ggtitle("London") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Type of room", y = "Number of rooms", fill = "Type of room") +
  scale_fill_viridis_d()
```

**Quantity of type of rooms in Paris**
```{r, echo=FALSE}
ggplot(list_par, aes(x = room_type)) +
  geom_bar(aes(fill = room_type), position = "dodge") +
  ggtitle("Paris") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Type of room", y = "Number of rooms", fill = "Type of room") +
  scale_fill_viridis_d()
```

**Quantity of type of rooms in Rome**
```{r, echo=FALSE}
ggplot(list_rom, aes(x = room_type)) +
  geom_bar(aes(fill = room_type), position = "dodge") +
  ggtitle("Rome") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Type of room", y = "Number of rooms", fill = "Type of room") +
  scale_fill_viridis_d()
```

**Percentage of rooms offered in Amsterdam**
```{r, echo=FALSE}
ggplot(list_ams, aes(x = room_type)) +
  geom_bar(aes(y = (..count..)/sum(..count..), fill = room_type), position = "dodge") +
  ggtitle("Amsterdam") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Type of room", y = "Number of rooms", fill = "Type of room") +
  scale_fill_viridis_d() +
  scale_y_continuous(labels = scales::percent_format(), name = "Percentage of rooms")
```

**Percentage of rooms offered in London**
```{r, echo=FALSE}
ggplot(list_lon, aes(x = room_type)) +
  geom_bar(aes(y = (..count..)/sum(..count..), fill = room_type), position = "dodge") +
  ggtitle("London") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Type of room", y = "Number of rooms", fill = "Type of room") +
  scale_fill_viridis_d() +
  scale_y_continuous(labels = scales::percent_format(), name = "Percentage of rooms")
```

**Percentage of rooms offered in Paris**
```{r, echo=FALSE}
ggplot(list_par, aes(x = room_type)) +
  geom_bar(aes(y = (..count..)/sum(..count..), fill = room_type), position = "dodge") +
  ggtitle("Paris") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Type of room", y = "Number of rooms", fill = "Type of room") +
  scale_fill_viridis_d() +
  scale_y_continuous(labels = scales::percent_format(), name = "Percentage of rooms")
```

**Percentage of rooms offered in Rome**
```{r, echo=FALSE}
ggplot(list_rom, aes(x = room_type)) +
  geom_bar(aes(y = (..count..)/sum(..count..), fill = room_type), position = "dodge") +
  ggtitle("Rome") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Type of room", y = "Number of rooms", fill = "Type of room") +
  scale_fill_viridis_d() +
  scale_y_continuous(labels = scales::percent_format(), name = "Percentage of rooms")
```

**Number and type of rooms comparison between the cities**
```{r, echo=FALSE}
ggplot(total_list, aes(x = room_type)) +
  geom_bar(aes(fill = room_type), position = "dodge") +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +
  facet_grid(~city) +
  labs(x = "Type of room", y = "Number of rooms", fill = "Type of room") +
  scale_fill_viridis_d()
```

